<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <body>
    <script src="../../dist/vue.global.js"></script>
    <script>
      const { reactive, effect, queueJob } = MiniVue
      const obj = {
        count: 0
      }
      // 普通
      // const observed = reactive(obj)
      // effect(() => {
      //   console.log('observed.count is:', observed.count)
      // })

      // reactive(reactive(obj))
      // const observed2 = reactive(reactive({ count: 0 }))
      // effect(() => {
      //   console.log('observed.count is:', observed2.count)
      // })

      // hasChanged
      // const observed = reactive(obj)
      // effect(() => {
      //   console.log('observed.count is:', observed.count)
      // })

      // 嵌套 effect
      // activeEffect = out
      //    activeEffect = inner
      // const observed = reactive({
      //   count1: 0,
      //   count2: 10,
      // })

      // effect(function out() {
      //   effect(function inner() {
      //     console.log('count2 is:', observed.count2)
      //   })
      //   console.log('count1 is:', observed.count1)
      // })

      // 完善调度器 - 合并任务，多次同时间内的任务只执行最后一次
      // const observed = reactive(obj)
      // effect(() => console.log(observed.count), {
      //   scheduler(fn) {
      //     queueJob()
      //   },
      // })
      // observed.count++
      // observed.count++

      // effect 分支切换与 cleanup
      const observed = reactive({ ok: true, text: 'sql' })
      effect(() => {
        console.log(observed.ok ? observed.text : '无')
      })
      observed.ok = false
      observed.text = 'sql2'
    </script>
  </body>
</html>
